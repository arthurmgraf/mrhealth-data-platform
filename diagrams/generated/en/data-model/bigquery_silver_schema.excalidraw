{
  "type": "excalidraw",
  "version": 2,
  "source": "claude-code-mrhealth",
  "elements": [
    {"id":"logo","type":"image","x":40,"y":15,"width":40,"height":40,"status":"saved","fileId":"bigquery_logo","scale":[1,1]},
    {"id":"title","type":"text","x":90,"y":20,"width":1200,"height":40,"text":"BigQuery Silver Layer - Cleaned & Enriched Schema","fontSize":28,"fontFamily":3,"strokeColor":"#4285F4"},
    {"id":"subtitle","type":"text","x":40,"y":65,"width":1200,"height":20,"text":"Dataset: mrhealth_silver | Transforms: Deduplication, Type Casting, Normalization, FK Validation | Refresh: Daily CREATE OR REPLACE","fontSize":14,"fontFamily":3,"strokeColor":"#868e96"},

    {"id":"orders_box","type":"rectangle","x":40,"y":120,"width":400,"height":420,"strokeColor":"#364fc7","backgroundColor":"#edf2ff","fillStyle":"solid","strokeWidth":2,"roundness":{"type":3}},
    {"id":"orders_header","type":"rectangle","x":40,"y":120,"width":400,"height":40,"strokeColor":"#364fc7","backgroundColor":"#4263eb","fillStyle":"solid","strokeWidth":2},
    {"id":"orders_title","type":"text","x":55,"y":130,"width":370,"height":25,"text":"orders (Cleaned & Deduplicated)","fontSize":16,"fontFamily":3,"strokeColor":"#ffffff"},
    {"id":"orders_cols","type":"text","x":55,"y":175,"width":370,"height":355,"text":"PK order_id           STRING         PK (renamed)\nFK unit_id            INT64          FK -> units (validated)\n   order_type         STRING         UPPER() normalized\n   order_status       STRING         UPPER() normalized\n   order_value        FLOAT64        ROUND(,2)\n   delivery_fee       FLOAT64        ROUND(,2)\n   order_date         DATE           (renamed from dt_pedido)\n   total_items        INT64          [NEW] CALCULATED\n---\nMetadata:\n   _source_file       STRING\n   _ingest_date       DATE\n---\nTransformations Applied:\n  [OK] Deduplication: ROW_NUMBER() OVER\n     (PARTITION BY order_id ORDER BY _ingest DESC)\n  [OK] Field Rename: id_pedido -> order_id\n  [OK] Normalization: UPPER(tipo_pedido)\n  [OK] Calculated: total_items from order_items\n  [OK] FK Validation: INNER JOIN validates unit_id","fontSize":10,"fontFamily":3,"strokeColor":"#495057"},

    {"id":"items_box","type":"rectangle","x":470,"y":120,"width":400,"height":420,"strokeColor":"#364fc7","backgroundColor":"#edf2ff","fillStyle":"solid","strokeWidth":2,"roundness":{"type":3}},
    {"id":"items_header","type":"rectangle","x":470,"y":120,"width":400,"height":40,"strokeColor":"#364fc7","backgroundColor":"#4263eb","fillStyle":"solid","strokeWidth":2},
    {"id":"items_title","type":"text","x":485,"y":130,"width":370,"height":25,"text":"order_items (Cleaned & Calculated)","fontSize":16,"fontFamily":3,"strokeColor":"#ffffff"},
    {"id":"items_cols","type":"text","x":485,"y":175,"width":370,"height":355,"text":"PK order_item_id      STRING         PK (renamed)\nFK order_id           STRING         FK -> orders (validated)\nFK product_id         INT64          FK -> products\n   quantity           INT64          [CAST] from FLOAT\n   unit_price         FLOAT64        ROUND(,2)\n   total_item_value   FLOAT64        [NEW] qty x unit_price\n   observation        STRING         TRIM() + NULLIF('')\n---\nMetadata:\n   _source_file       STRING\n   _ingest_date       DATE\n---\nTransformations Applied:\n  [OK] Deduplication: ROW_NUMBER() OVER\n     (PARTITION BY order_item_id ORDER BY _ingest DESC)\n  [OK] Type Cast: CAST(qtd AS INT64)\n  [OK] Calculated: total_item_value = qty x price\n  [OK] String Clean: TRIM(), NULLIF empty\n  [OK] FK Validation: INNER JOIN with orders","fontSize":10,"fontFamily":3,"strokeColor":"#495057"},

    {"id":"products_box","type":"rectangle","x":900,"y":120,"width":320,"height":200,"strokeColor":"#364fc7","backgroundColor":"#edf2ff","fillStyle":"solid","strokeWidth":2,"roundness":{"type":3}},
    {"id":"products_header","type":"rectangle","x":900,"y":120,"width":320,"height":40,"strokeColor":"#364fc7","backgroundColor":"#4263eb","fillStyle":"solid","strokeWidth":2},
    {"id":"products_title","type":"text","x":915,"y":130,"width":290,"height":25,"text":"products (Reference)","fontSize":16,"fontFamily":3,"strokeColor":"#ffffff"},
    {"id":"products_cols","type":"text","x":915,"y":175,"width":290,"height":135,"text":"PK product_id         INT64          PK\n   product_name       STRING         TRIM()\n---\nTransformations:\n  [OK] Field Rename: id_produto -> product_id\n  [OK] String Clean: TRIM(nome_produto)\n---\nSource: Bronze products table","fontSize":10,"fontFamily":3,"strokeColor":"#495057"},

    {"id":"units_box","type":"rectangle","x":900,"y":340,"width":320,"height":260,"strokeColor":"#364fc7","backgroundColor":"#edf2ff","fillStyle":"solid","strokeWidth":2,"roundness":{"type":3}},
    {"id":"units_header","type":"rectangle","x":900,"y":340,"width":320,"height":40,"strokeColor":"#364fc7","backgroundColor":"#4263eb","fillStyle":"solid","strokeWidth":2},
    {"id":"units_title","type":"text","x":915,"y":350,"width":290,"height":25,"text":"units (Denormalized)","fontSize":16,"fontFamily":3,"strokeColor":"#ffffff"},
    {"id":"units_cols","type":"text","x":915,"y":395,"width":290,"height":195,"text":"PK unit_id            INT64          PK\n   unit_name          STRING         TRIM()\n   state_id           INT64          [NEW] from JOIN\n   state_name         STRING         [NEW] from JOIN\n   country_id         INT64          [NEW] from JOIN\n   country_name       STRING         [NEW] from JOIN\n---\nDenormalization:\n  [OK] JOIN with states\n  [OK] JOIN with countries\n  -> Eliminates runtime JOINs\n  -> Improves query performance","fontSize":10,"fontFamily":3,"strokeColor":"#495057"},

    {"id":"states_box","type":"rectangle","x":40,"y":560,"width":300,"height":180,"strokeColor":"#364fc7","backgroundColor":"#edf2ff","fillStyle":"solid","strokeWidth":2,"roundness":{"type":3}},
    {"id":"states_header","type":"rectangle","x":40,"y":560,"width":300,"height":40,"strokeColor":"#364fc7","backgroundColor":"#4263eb","fillStyle":"solid","strokeWidth":2},
    {"id":"states_title","type":"text","x":55,"y":570,"width":270,"height":25,"text":"states (Reference)","fontSize":16,"fontFamily":3,"strokeColor":"#ffffff"},
    {"id":"states_cols","type":"text","x":55,"y":615,"width":270,"height":115,"text":"PK state_id           INT64          PK\n   state_name         STRING         TRIM()\nFK country_id         INT64          FK\n---\nTransformations:\n  [OK] Field Rename: id_estado -> state_id\n  [OK] String Clean: TRIM()","fontSize":10,"fontFamily":3,"strokeColor":"#495057"},

    {"id":"countries_box","type":"rectangle","x":370,"y":560,"width":300,"height":180,"strokeColor":"#364fc7","backgroundColor":"#edf2ff","fillStyle":"solid","strokeWidth":2,"roundness":{"type":3}},
    {"id":"countries_header","type":"rectangle","x":370,"y":560,"width":300,"height":40,"strokeColor":"#364fc7","backgroundColor":"#4263eb","fillStyle":"solid","strokeWidth":2},
    {"id":"countries_title","type":"text","x":385,"y":570,"width":270,"height":25,"text":"countries (Reference)","fontSize":16,"fontFamily":3,"strokeColor":"#ffffff"},
    {"id":"countries_cols","type":"text","x":385,"y":615,"width":270,"height":115,"text":"PK country_id         INT64          PK\n   country_name       STRING         TRIM()\n---\nTransformations:\n  [OK] Field Rename: id_pais -> country_id\n  [OK] String Clean: TRIM()","fontSize":10,"fontFamily":3,"strokeColor":"#495057"},

    {"id":"transform_box","type":"rectangle","x":700,"y":620,"width":520,"height":200,"strokeColor":"#1971c2","backgroundColor":"#e7f5ff","fillStyle":"solid","strokeWidth":2},
    {"id":"transform_title","type":"text","x":720,"y":635,"width":300,"height":22,"text":"Silver Transformation Summary","fontSize":14,"fontFamily":3,"strokeColor":"#1971c2"},
    {"id":"transform_content","type":"text","x":720,"y":665,"width":480,"height":145,"text":"Airflow Tasks: run_silver_reference, run_silver_orders\nSchedule: 02:30 BRT daily (after Bronze load completes)\nOperator: BigQueryInsertJobOperator\n\nKey Transformations:\n  - Deduplication: Keep latest record per PK (ROW_NUMBER window)\n  - Type Safety: CAST numeric fields, validate dates\n  - Normalization: UPPER/LOWER, TRIM, NULLIF empty strings\n  - Calculated Fields: total_items, total_item_value\n  - Referential Integrity: INNER JOIN validates all FK relationships\n  - Denormalization: Flatten geography hierarchy in units table\n\nOutput: CREATE OR REPLACE TABLE (full refresh, MERGE planned for v2)","fontSize":10,"fontFamily":3,"strokeColor":"#495057"}
  ],
  "appState": {"viewBackgroundColor":"#ffffff","gridSize":null},
  "files": {
    "bigquery_logo": {
      "mimeType": "image/svg+xml",
      "id": "bigquery_logo",
      "dataURL": "data:image/svg+xml;base64,PHN2ZyBmaWxsPSIjNDI4NUY0IiByb2xlPSJpbWciIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48dGl0bGU+R29vZ2xlIEJpZ1F1ZXJ5PC90aXRsZT48cGF0aCBkPSJNNS42NzYgMTAuNTk1aDIuMDUydjUuMjQ0YTUuODkyIDUuODkyIDAgMCAxLTIuMDUyLTIuMDg4di0zLjE1NnptMTguMTc5IDEwLjgzNmEuNTA0LjUwNCAwIDAgMSAwIC43MDhsLTEuNzE2IDEuNzE2YS41MDQuNTA0IDAgMCAxLS43MDggMGwtNC4yNDgtNC4yNDhhLjIwNi4yMDYgMCAwIDEtLjAwNy0uMDA3Yy0uMDItLjAyLS4wMjgtLjA0NS0uMDQzLS4wNjZhMTAuNzM2IDEwLjczNiAwIDAgMS02LjMzNCAyLjA2NUM0LjgzNSAyMS41OTkgMCAxNi43NjQgMCAxMC43OTlTNC44MzUgMCAxMC44IDBzMTAuNzk5IDQuODM1IDEwLjc5OSAxMC44YzAgMi4zNjktLjc3MiA0LjU1My0yLjA2NiA2LjMzMy4wMjUuMDE3LjA1Mi4wMjguMDc0LjA1bDQuMjQ4IDQuMjQ4em0tNS4wMjgtMTAuNjMyYTguMDE1IDguMDE1IDAgMSAwLTguMDI4IDguMDI4aC4wMjRhOC4wMTYgOC4wMTYgMCAwIDAgOC4wMDQtOC4wMjh6bS00Ljg2IDQuOThhNi4wMDIgNi4wMDIgMCAwIDAgMi4wNC0yLjE4NHYtMS43NjRoLTIuMDR2My45NDh6bS00LjUuOTQ4Yy40NDIuMDU3Ljg4Ny4wOCAxLjMzMi4wNzIuNC4wMjUuOC4wMjUgMS4yIDBWNy42OTJIOS40Njh2OS4wMzV6Ii8+PC9zdmc+",
      "created": 1706745600000
    }
  }
}
