{
  "type": "excalidraw",
  "version": 2,
  "source": "claude-code-mrhealth",
  "elements": [
    {"id":"title","type":"text","x":40,"y":20,"width":1200,"height":40,"text":"ğŸ¥ˆ BigQuery Silver Layer - Cleaned & Enriched Schema","fontSize":28,"fontFamily":3,"strokeColor":"#4263eb"},
    {"id":"subtitle","type":"text","x":40,"y":65,"width":1200,"height":20,"text":"Dataset: case_ficticio_silver | Transforms: Deduplication, Type Casting, Normalization, FK Validation | Refresh: Daily CREATE OR REPLACE","fontSize":14,"fontFamily":3,"strokeColor":"#868e96"},

    {"id":"orders_box","type":"rectangle","x":40,"y":120,"width":400,"height":420,"strokeColor":"#364fc7","backgroundColor":"#edf2ff","fillStyle":"solid","strokeWidth":2,"roundness":{"type":3}},
    {"id":"orders_header","type":"rectangle","x":40,"y":120,"width":400,"height":40,"strokeColor":"#364fc7","backgroundColor":"#4263eb","fillStyle":"solid","strokeWidth":2},
    {"id":"orders_title","type":"text","x":55,"y":130,"width":370,"height":25,"text":"ğŸ“‹ orders (Cleaned & Deduplicated)","fontSize":16,"fontFamily":3,"strokeColor":"#ffffff"},
    {"id":"orders_cols","type":"text","x":55,"y":175,"width":370,"height":355,"text":"ğŸ”‘ order_id           STRING         PK (renamed)\nğŸ”— unit_id            INT64          FK â†’ units (validated)\n   order_type         STRING         UPPER() normalized\n   order_status       STRING         UPPER() normalized\n   order_value        FLOAT64        ROUND(,2)\n   delivery_fee       FLOAT64        ROUND(,2)\n   order_date         DATE           (renamed from dt_pedido)\n   total_items        INT64          ğŸ†• CALCULATED\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nMetadata:\n   _source_file       STRING\n   _ingest_date       DATE\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nTransformations Applied:\n  âœ… Deduplication: ROW_NUMBER() OVER\n     (PARTITION BY order_id ORDER BY _ingest DESC)\n  âœ… Field Rename: id_pedido â†’ order_id\n  âœ… Normalization: UPPER(tipo_pedido)\n  âœ… Calculated: total_items from order_items\n  âœ… FK Validation: INNER JOIN validates unit_id","fontSize":10,"fontFamily":3,"strokeColor":"#495057"},

    {"id":"items_box","type":"rectangle","x":470,"y":120,"width":400,"height":420,"strokeColor":"#364fc7","backgroundColor":"#edf2ff","fillStyle":"solid","strokeWidth":2,"roundness":{"type":3}},
    {"id":"items_header","type":"rectangle","x":470,"y":120,"width":400,"height":40,"strokeColor":"#364fc7","backgroundColor":"#4263eb","fillStyle":"solid","strokeWidth":2},
    {"id":"items_title","type":"text","x":485,"y":130,"width":370,"height":25,"text":"ğŸ“‹ order_items (Cleaned & Calculated)","fontSize":16,"fontFamily":3,"strokeColor":"#ffffff"},
    {"id":"items_cols","type":"text","x":485,"y":175,"width":370,"height":355,"text":"ğŸ”‘ order_item_id      STRING         PK (renamed)\nğŸ”— order_id           STRING         FK â†’ orders (validated)\nğŸ”— product_id         INT64          FK â†’ products\n   quantity           INT64          ğŸ”„ CAST from FLOAT\n   unit_price         FLOAT64        ROUND(,2)\n   total_item_value   FLOAT64        ğŸ†• qty Ã— unit_price\n   observation        STRING         TRIM() + NULLIF('')\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nMetadata:\n   _source_file       STRING\n   _ingest_date       DATE\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nTransformations Applied:\n  âœ… Deduplication: ROW_NUMBER() OVER\n     (PARTITION BY order_item_id ORDER BY _ingest DESC)\n  âœ… Type Cast: CAST(qtd AS INT64)\n  âœ… Calculated: total_item_value = qty Ã— price\n  âœ… String Clean: TRIM(), NULLIF empty\n  âœ… FK Validation: INNER JOIN with orders","fontSize":10,"fontFamily":3,"strokeColor":"#495057"},

    {"id":"products_box","type":"rectangle","x":900,"y":120,"width":320,"height":200,"strokeColor":"#364fc7","backgroundColor":"#edf2ff","fillStyle":"solid","strokeWidth":2,"roundness":{"type":3}},
    {"id":"products_header","type":"rectangle","x":900,"y":120,"width":320,"height":40,"strokeColor":"#364fc7","backgroundColor":"#4263eb","fillStyle":"solid","strokeWidth":2},
    {"id":"products_title","type":"text","x":915,"y":130,"width":290,"height":25,"text":"ğŸ“‹ products (Reference)","fontSize":16,"fontFamily":3,"strokeColor":"#ffffff"},
    {"id":"products_cols","type":"text","x":915,"y":175,"width":290,"height":135,"text":"ğŸ”‘ product_id         INT64          PK\n   product_name       STRING         TRIM()\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nTransformations:\n  âœ… Field Rename: id_produto â†’ product_id\n  âœ… String Clean: TRIM(nome_produto)\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nSource: Bronze products table","fontSize":10,"fontFamily":3,"strokeColor":"#495057"},

    {"id":"units_box","type":"rectangle","x":900,"y":340,"width":320,"height":260,"strokeColor":"#364fc7","backgroundColor":"#edf2ff","fillStyle":"solid","strokeWidth":2,"roundness":{"type":3}},
    {"id":"units_header","type":"rectangle","x":900,"y":340,"width":320,"height":40,"strokeColor":"#364fc7","backgroundColor":"#4263eb","fillStyle":"solid","strokeWidth":2},
    {"id":"units_title","type":"text","x":915,"y":350,"width":290,"height":25,"text":"ğŸ“‹ units (Denormalized)","fontSize":16,"fontFamily":3,"strokeColor":"#ffffff"},
    {"id":"units_cols","type":"text","x":915,"y":395,"width":290,"height":195,"text":"ğŸ”‘ unit_id            INT64          PK\n   unit_name          STRING         TRIM()\n   state_id           INT64          ğŸ†• from JOIN\n   state_name         STRING         ğŸ†• from JOIN\n   country_id         INT64          ğŸ†• from JOIN\n   country_name       STRING         ğŸ†• from JOIN\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nDenormalization:\n  âœ… JOIN with states\n  âœ… JOIN with countries\n  â†’ Eliminates runtime JOINs\n  â†’ Improves query performance","fontSize":10,"fontFamily":3,"strokeColor":"#495057"},

    {"id":"states_box","type":"rectangle","x":40,"y":560,"width":300,"height":180,"strokeColor":"#364fc7","backgroundColor":"#edf2ff","fillStyle":"solid","strokeWidth":2,"roundness":{"type":3}},
    {"id":"states_header","type":"rectangle","x":40,"y":560,"width":300,"height":40,"strokeColor":"#364fc7","backgroundColor":"#4263eb","fillStyle":"solid","strokeWidth":2},
    {"id":"states_title","type":"text","x":55,"y":570,"width":270,"height":25,"text":"ğŸ“‹ states (Reference)","fontSize":16,"fontFamily":3,"strokeColor":"#ffffff"},
    {"id":"states_cols","type":"text","x":55,"y":615,"width":270,"height":115,"text":"ğŸ”‘ state_id           INT64          PK\n   state_name         STRING         TRIM()\nğŸ”— country_id         INT64          FK\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nTransformations:\n  âœ… Field Rename: id_estado â†’ state_id\n  âœ… String Clean: TRIM()","fontSize":10,"fontFamily":3,"strokeColor":"#495057"},

    {"id":"countries_box","type":"rectangle","x":370,"y":560,"width":300,"height":180,"strokeColor":"#364fc7","backgroundColor":"#edf2ff","fillStyle":"solid","strokeWidth":2,"roundness":{"type":3}},
    {"id":"countries_header","type":"rectangle","x":370,"y":560,"width":300,"height":40,"strokeColor":"#364fc7","backgroundColor":"#4263eb","fillStyle":"solid","strokeWidth":2},
    {"id":"countries_title","type":"text","x":385,"y":570,"width":270,"height":25,"text":"ğŸ“‹ countries (Reference)","fontSize":16,"fontFamily":3,"strokeColor":"#ffffff"},
    {"id":"countries_cols","type":"text","x":385,"y":615,"width":270,"height":115,"text":"ğŸ”‘ country_id         INT64          PK\n   country_name       STRING         TRIM()\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nTransformations:\n  âœ… Field Rename: id_pais â†’ country_id\n  âœ… String Clean: TRIM()","fontSize":10,"fontFamily":3,"strokeColor":"#495057"},

    {"id":"transform_box","type":"rectangle","x":700,"y":620,"width":520,"height":200,"strokeColor":"#1971c2","backgroundColor":"#e7f5ff","fillStyle":"solid","strokeWidth":2},
    {"id":"transform_title","type":"text","x":720,"y":635,"width":300,"height":22,"text":"ğŸ”„ Silver Transformation Summary","fontSize":14,"fontFamily":3,"strokeColor":"#1971c2"},
    {"id":"transform_content","type":"text","x":720,"y":665,"width":480,"height":145,"text":"Airflow Tasks: run_silver_reference, run_silver_orders\nSchedule: 02:30 BRT daily (after Bronze load completes)\nOperator: BigQueryInsertJobOperator\n\nKey Transformations:\n  â€¢ Deduplication: Keep latest record per PK (ROW_NUMBER window)\n  â€¢ Type Safety: CAST numeric fields, validate dates\n  â€¢ Normalization: UPPER/LOWER, TRIM, NULLIF empty strings\n  â€¢ Calculated Fields: total_items, total_item_value\n  â€¢ Referential Integrity: INNER JOIN validates all FK relationships\n  â€¢ Denormalization: Flatten geography hierarchy in units table\n\nOutput: CREATE OR REPLACE TABLE (full refresh, MERGE planned for v2)","fontSize":10,"fontFamily":3,"strokeColor":"#495057"}
  ],
  "appState": {"viewBackgroundColor":"#ffffff","gridSize":null},
  "files": {}
}
