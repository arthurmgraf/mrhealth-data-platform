{
  "type": "excalidraw",
  "version": 2,
  "source": "claude-code-mrhealth",
  "elements": [
    {"id":"title","type":"text","x":40,"y":20,"width":1200,"height":40,"text":"ğŸ¥‰ BigQuery Bronze Layer - Raw Data Schema","fontSize":28,"fontFamily":3,"strokeColor":"#9c6644"},
    {"id":"subtitle","type":"text","x":40,"y":65,"width":1200,"height":20,"text":"Dataset: case_ficticio_bronze | Mode: Append-only | Validation: PyArrow schemas | Partitioning: _ingest_date","fontSize":14,"fontFamily":3,"strokeColor":"#868e96"},

    {"id":"orders_box","type":"rectangle","x":40,"y":120,"width":380,"height":380,"strokeColor":"#8b5a2b","backgroundColor":"#fef3c7","fillStyle":"solid","strokeWidth":2,"roundness":{"type":3}},
    {"id":"orders_header","type":"rectangle","x":40,"y":120,"width":380,"height":40,"strokeColor":"#8b5a2b","backgroundColor":"#9c6644","fillStyle":"solid","strokeWidth":2},
    {"id":"orders_title","type":"text","x":55,"y":130,"width":350,"height":25,"text":"ğŸ“‹ orders (Transactional - Sales Headers)","fontSize":16,"fontFamily":3,"strokeColor":"#ffffff"},
    {"id":"orders_cols","type":"text","x":55,"y":175,"width":350,"height":310,"text":"ğŸ”‘ id_pedido          STRING         PK\n   id_unidade         INT64          FK â†’ units\n   tipo_pedido        STRING         ONLINE/PHYSICAL\n   status_pedido      STRING         Finalizado/Cancelado/Pendente\n   valor_pedido       FLOAT64        Order total (R$)\n   taxa_entrega       FLOAT64        Delivery fee (R$)\n   dt_pedido          DATE           Order date\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nMetadata Columns:\n   _source_file       STRING         CSV filename\n   _ingest_timestamp  TIMESTAMP      Load time (UTC)\n   _ingest_date       DATE           Partition key\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nVolume: ~5,000 orders/day (100/unit)\nFormat: pedidos_YYYYMMDD.csv\nTrigger: Eventarc on GCS upload\nLoad: WRITE_APPEND (immutable)","fontSize":11,"fontFamily":3,"strokeColor":"#495057"},

    {"id":"items_box","type":"rectangle","x":450,"y":120,"width":380,"height":380,"strokeColor":"#8b5a2b","backgroundColor":"#fef3c7","fillStyle":"solid","strokeWidth":2,"roundness":{"type":3}},
    {"id":"items_header","type":"rectangle","x":450,"y":120,"width":380,"height":40,"strokeColor":"#8b5a2b","backgroundColor":"#9c6644","fillStyle":"solid","strokeWidth":2},
    {"id":"items_title","type":"text","x":465,"y":130,"width":350,"height":25,"text":"ğŸ“‹ order_items (Transactional - Line Items)","fontSize":16,"fontFamily":3,"strokeColor":"#ffffff"},
    {"id":"items_cols","type":"text","x":465,"y":175,"width":350,"height":310,"text":"ğŸ”‘ id_item_pedido     STRING         PK\nğŸ”— id_pedido          STRING         FK â†’ orders\nğŸ”— id_produto         INT64          FK â†’ products\n   qtd                FLOAT64        Quantity ordered\n   vlr_item           FLOAT64        Unit price (R$)\n   observacao         STRING         Special instructions\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nMetadata Columns:\n   _source_file       STRING         CSV filename\n   _ingest_timestamp  TIMESTAMP      Load time (UTC)\n   _ingest_date       DATE           Partition key\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nVolume: ~15,000-25,000 items/day\nAverage: 3-5 items per order\nFormat: itens_pedido_YYYYMMDD.csv\nRelationship: N:1 with orders\nLoad: WRITE_APPEND (immutable)","fontSize":11,"fontFamily":3,"strokeColor":"#495057"},

    {"id":"products_box","type":"rectangle","x":860,"y":120,"width":340,"height":230,"strokeColor":"#8b5a2b","backgroundColor":"#fef3c7","fillStyle":"solid","strokeWidth":2,"roundness":{"type":3}},
    {"id":"products_header","type":"rectangle","x":860,"y":120,"width":340,"height":40,"strokeColor":"#8b5a2b","backgroundColor":"#9c6644","fillStyle":"solid","strokeWidth":2},
    {"id":"products_title","type":"text","x":875,"y":130,"width":310,"height":25,"text":"ğŸ“‹ products (Reference - Menu)","fontSize":16,"fontFamily":3,"strokeColor":"#ffffff"},
    {"id":"products_cols","type":"text","x":875,"y":175,"width":310,"height":165,"text":"ğŸ”‘ id_produto         INT64          PK\n   nome_produto       STRING         Product name\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nMetadata Columns:\n   _source_file       STRING\n   _ingest_timestamp  TIMESTAMP\n   _ingest_date       DATE\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nRows: ~200 products\nSource: PostgreSQL â†’ GCS\nRefresh: Daily (pg-reference-extractor)","fontSize":11,"fontFamily":3,"strokeColor":"#495057"},

    {"id":"units_box","type":"rectangle","x":860,"y":370,"width":340,"height":230,"strokeColor":"#8b5a2b","backgroundColor":"#fef3c7","fillStyle":"solid","strokeWidth":2,"roundness":{"type":3}},
    {"id":"units_header","type":"rectangle","x":860,"y":370,"width":340,"height":40,"strokeColor":"#8b5a2b","backgroundColor":"#9c6644","fillStyle":"solid","strokeWidth":2},
    {"id":"units_title","type":"text","x":875,"y":380,"width":310,"height":25,"text":"ğŸ“‹ units (Reference - Restaurants)","fontSize":16,"fontFamily":3,"strokeColor":"#ffffff"},
    {"id":"units_cols","type":"text","x":875,"y":425,"width":310,"height":165,"text":"ğŸ”‘ id_unidade         INT64          PK\n   nome_unidade       STRING         Unit name\nğŸ”— id_estado          INT64          FK â†’ states\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nMetadata Columns:\n   _source_file       STRING\n   _ingest_timestamp  TIMESTAMP\n   _ingest_date       DATE\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nRows: 50 units\nSource: PostgreSQL â†’ GCS\nRefresh: Daily","fontSize":11,"fontFamily":3,"strokeColor":"#495057"},

    {"id":"states_box","type":"rectangle","x":40,"y":520,"width":340,"height":200,"strokeColor":"#8b5a2b","backgroundColor":"#fef3c7","fillStyle":"solid","strokeWidth":2,"roundness":{"type":3}},
    {"id":"states_header","type":"rectangle","x":40,"y":520,"width":340,"height":40,"strokeColor":"#8b5a2b","backgroundColor":"#9c6644","fillStyle":"solid","strokeWidth":2},
    {"id":"states_title","type":"text","x":55,"y":530,"width":310,"height":25,"text":"ğŸ“‹ states (Reference - Geography)","fontSize":16,"fontFamily":3,"strokeColor":"#ffffff"},
    {"id":"states_cols","type":"text","x":55,"y":575,"width":310,"height":135,"text":"ğŸ”‘ id_estado          INT64          PK\n   nome_estado        STRING         State name\nğŸ”— id_pais            INT64          FK â†’ countries\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nMetadata: _source_file, _ingest_*\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nRows: 3 (RS, SC, PR)\nSource: PostgreSQL â†’ GCS","fontSize":11,"fontFamily":3,"strokeColor":"#495057"},

    {"id":"countries_box","type":"rectangle","x":410,"y":520,"width":340,"height":200,"strokeColor":"#8b5a2b","backgroundColor":"#fef3c7","fillStyle":"solid","strokeWidth":2,"roundness":{"type":3}},
    {"id":"countries_header","type":"rectangle","x":410,"y":520,"width":340,"height":40,"strokeColor":"#8b5a2b","backgroundColor":"#9c6644","fillStyle":"solid","strokeWidth":2},
    {"id":"countries_title","type":"text","x":425,"y":530,"width":310,"height":25,"text":"ğŸ“‹ countries (Reference - Geography)","fontSize":16,"fontFamily":3,"strokeColor":"#ffffff"},
    {"id":"countries_cols","type":"text","x":425,"y":575,"width":310,"height":135,"text":"ğŸ”‘ id_pais            INT64          PK\n   nome_pais          STRING         Country name\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nMetadata: _source_file, _ingest_*\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nRows: 1 (Brasil)\nSource: PostgreSQL â†’ GCS","fontSize":11,"fontFamily":3,"strokeColor":"#495057"},

    {"id":"fk_orders_items","type":"arrow","x":420,"y":300,"width":30,"height":0,"strokeColor":"#1971c2","strokeWidth":2,"points":[[0,0],[30,0]],"endArrowhead":"arrow","startArrowhead":"arrow"},
    {"id":"fk_label1","type":"text","x":425,"y":280,"width":30,"height":15,"text":"1:N","fontSize":10,"fontFamily":3,"strokeColor":"#1971c2"},

    {"id":"fk_items_products","type":"arrow","x":830,"y":280,"width":30,"height":0,"strokeColor":"#1971c2","strokeWidth":2,"points":[[0,0],[30,0]],"endArrowhead":"arrow"},
    {"id":"fk_units_states","type":"arrow","x":860,"y":540,"width":-120,"height":0,"strokeColor":"#1971c2","strokeWidth":2,"points":[[0,0],[-120,0]],"endArrowhead":"arrow"},
    {"id":"fk_states_countries","type":"arrow","x":380,"y":620,"width":30,"height":0,"strokeColor":"#1971c2","strokeWidth":2,"points":[[0,0],[30,0]],"endArrowhead":"arrow"},

    {"id":"ingestion_box","type":"rectangle","x":40,"y":750,"width":1160,"height":150,"strokeColor":"#d9480f","backgroundColor":"#fff4e6","fillStyle":"solid","strokeWidth":2},
    {"id":"ingestion_title","type":"text","x":60,"y":765,"width":300,"height":22,"text":"âš¡ Ingestion Pipeline (csv-processor Cloud Function)","fontSize":14,"fontFamily":3,"strokeColor":"#d9480f"},
    {"id":"ingestion_content","type":"text","x":60,"y":795,"width":550,"height":95,"text":"Trigger: Eventarc (google.cloud.storage.object.v1.finalized)\nBucket: dados-sales-machine-learning\nPrefix: raw/\n\nValidation Steps:\n  1. PyArrow schema enforcement (type checking)\n  2. Required fields validation (non-null PKs)\n  3. Date format normalization (DD/MM/YYYY â†’ DATE)","fontSize":10,"fontFamily":3,"strokeColor":"#495057"},
    {"id":"ingestion_config","type":"text","x":630,"y":795,"width":550,"height":95,"text":"Cloud Function Config:\n  Runtime: Python 3.11\n  Memory: 512MB\n  Timeout: 60 seconds\n  Entry Point: process_csv\n\nLoad Configuration:\n  Mode: WRITE_APPEND (append-only, immutable)\n  Partitioning: _ingest_date (DATE)\n  Clustering: id_unidade (for unit-level queries)","fontSize":10,"fontFamily":3,"strokeColor":"#495057"}
  ],
  "appState": {"viewBackgroundColor":"#ffffff","gridSize":null},
  "files": {}
}
